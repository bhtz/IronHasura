@attribute [Authorize]
@page "/storage"

<MudToolBar>
    <MudText Typo="Typo.h6">Storage</MudText>
    <MudSpacer />
    <InputFile id="fileInput" OnChange="OnInputFileChange" hidden />
    <MudIconButton Title="Upload file" HtmlTag="label" Color="Color.Primary" Icon="@Icons.Filled.CloudUpload" for="fileInput"></MudIconButton>
    <MudIconButton Title="Create container / bucket" @onclick="() => OpenCreateContainerDialog()" Icon="@Icons.Material.Filled.CreateNewFolder" Color="Color.Primary"></MudIconButton>
    <MudIconButton Title="Refresh" @onclick="() => GetBlobsFromSelectedContainer()" Icon="@Icons.Material.Filled.Refresh" Color="Color.Primary"></MudIconButton>
</MudToolBar>

<MudSelect Disabled="Containers.Count == 0" @bind-Value="SelectedContainer" T="string" Label="Container" Strict="true" >
    @foreach (var item in Containers)
    {
        <MudSelectItem Value="@item">@item</MudSelectItem>
    }
</MudSelect>

<MudDataGrid Class="mt-4" T="string" Loading="IsLoading" LoadingProgressColor="Color.Primary" Items="@Blobs" Dense="true" Striped="true" Hover="true" Bordered="true" Filterable="true" QuickFilter="@FilterFunc" Hideable="true" ShowMenuIcon="true">
        <ToolBarContent>
            <MudTextField @bind-Value="SearchTerm" Placeholder="Search" Adornment="Adornment.Start" Immediate="true"
                AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Small" Class="mr-5"></MudTextField>
        </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x" Title="blob"/>
        <TemplateColumn T="string" Title="Actions" Filterable="false" Sortable="false">
            <CellTemplate>
                <MudIconButton @onclick="() => Download(context.Item)" title="Edit" Size="Size.Small" Icon="@Icons.Material.Filled.CloudDownload"></MudIconButton>
                <MudIconButton @onclick="() => DeleteBlob(context.Item)" title="Delete" Size="Size.Small" Icon="@Icons.Material.Filled.Delete" Color="Color.Error"></MudIconButton>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>
